name: CGKR Code Review

on:
  pull_request:
    types: [opened, synchronize, ready_for_review, reopened]

jobs:
  claude-review:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      issues: write
      id-token: write
      actions: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
        with:
          fetch-depth: 1 # 리뷰를 위해 코드를 가져옵니다.

      - name: Run Claude Code Review
        id: claude-review
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          plugin_marketplaces: "https://github.com/anthropics/claude-code.git"
          plugins: "code-review@claude-code-plugins"
          # 슬래시 커맨드 대신 자연어 프롬프트를 사용합니다.
          prompt: |
            REPO: ${{ github.repository }}
            PR NUMBER: ${{ github.event.pull_request.number }}

            이 PR(#${{ github.event.pull_request.number }})에 대해 코드 리뷰를 수행해주세요.
            설치된 code-review 플러그인의 기능을 활용하거나, 직접 변경 사항을 분석하여 다음 항목을 중점적으로 봐주세요:

            1. 잠재적인 버그
            2. 코드 품질 및 스타일
            3. 보안 취약점

            리뷰 결과는 GitHub PR 코멘트로 남겨주세요.
