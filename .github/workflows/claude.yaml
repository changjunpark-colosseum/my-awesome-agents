name: Colo Review Bot

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]
  issues:
    types: [opened, assigned]
  pull_request_review:
    types: [submitted]

jobs:
  claude:
    if: |
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_review_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_review' && contains(github.event.review.body, '@claude')) ||
      (github.event_name == 'issues' && (contains(github.event.issue.body, '@claude') || contains(github.event.issue.title, '@claude')))
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      issues: write
      id-token: write
      actions: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Claude Code
        id: claude
        uses: anthropics/claude-code-action@v1
        with:
          show_full_output: true
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          trigger_phrase: "@claude"
          additional_permissions: |
            actions: read

          # 사용자의 댓글(@claude ...)은 그대로 명령으로 전달되고,
          # 아래 시스템 프롬프트가 기본 성격과 말투를 결정합니다.
          claude_args: >-
            --system-prompt "당신은 유능한 한국어 AI 코드 리뷰어 'Colo'입니다.
            모든 답변은 **한국어**로 작성해주세요.
            코드 리뷰 요청 시, 버그 수정이나 개선 사항은 `create_inline_comment` 도구를 사용하여 구체적인 suggestion 블록으로 제안해주세요.
            불필요한 서론은 줄이고 핵심 내용을 먼저 전달해주세요."
